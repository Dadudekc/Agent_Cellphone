{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Change Contract",
  "type": "object",
  "required": [
    "id",
    "title",
    "rationale",
    "change_type",
    "affected_files",
    "acceptance_criteria",
    "tests_required",
    "owner",
    "fsm_state"
  ],
  "properties": {
    "id": { "type": "string", "minLength": 1 },
    "title": { "type": "string", "minLength": 1 },
    "rationale": { "type": "string", "minLength": 1 },
    "change_type": { "type": "string", "enum": ["feature", "bugfix", "refactor", "docs", "config"] },
    "affected_files": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["path", "op"],
        "properties": {
          "path": { "type": "string", "minLength": 1 },
          "op": { "type": "string", "enum": ["add", "edit", "remove"] }
        },
        "additionalProperties": false
      }
    },
    "acceptance_criteria": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 1 }
    },
    "tests_required": {
      "type": "array",
      "minItems": 1,
      "items": { "type": "string", "minLength": 1 }
    },
    "risk_level": { "type": "string", "enum": ["low", "medium", "high"], "default": "low" },
    "rollback_plan": { "type": "string" },
    "dependencies": {
      "type": "array",
      "items": { "type": "string" },
      "default": []
    },
    "owner": { "type": "string", "minLength": 1 },
    "reviewers": {
      "type": "array",
      "items": { "type": "string" },
      "default": []
    },
    "fsm_state": { "type": "string", "enum": ["Proposed", "Approved", "Implemented", "Tested", "Merged"] }
  },
  "additionalProperties": false
}


